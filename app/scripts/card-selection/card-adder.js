"use strict";let currentSetsCheckboxes=[],currentKingdom={},isGenerating=!1,isGeneratingFromCode=!1,loadedCards=0,gamesPlayed=0;const cardCounts={};let cardWorker=void 0,removeCardsTimeout=void 0;const WIKI_PREFIX="http://wiki.dominionstrategy.com/index.php/",DEBUG="cards",REPEAT=!1,REPEAT_MAX=50,totalSets={Dominion:0,Intrigue:1,Seaside:2,Alchemy:3,Prosperity:4,Cornucopia:5,Hinterlands:6,"Dark Ages":7,Guilds:8,Adventures:9,Empires:10};function generateNewKingdom(){if(!isGenerating&&!isGeneratingFromCode&&void 0===cardWorker){isGenerating=!0,isGeneratingFromCode=!1,currentKingdom.kingdomCards?animateCardsOut():$(".error-msg").removeClass("error-visible");$("#Generate-Drawer").hasClass("drawer-open");if($("#Generate-Drawer").trigger("drawer-close"),setLoadingProgress(0),$("#LoadingIndicator").addClass("loading"),$("#LoadingIndicator").addClass("animating"),$(".toolbar-cards").prop("disabled",!0),$(".toolbar-shuffle").prop("disabled",!0),"undefined"!=typeof Worker){if(void 0===cardWorker){for(setCheckbox of(cardWorker=new Worker("./app/scripts/card-selection/card-selector/card-selector.js"),selectedSets=[],currentSetsCheckboxes))setCheckbox.prop("checked")&&selectedSets.push(setCheckbox.attr("value"));let e="off",a="off",o="off",t="off",r="off",d="off";void 0!==typeof Storage&&(e=localStorage.getItem("Sets-Selection-Dominion1st Edition"),a=localStorage.getItem("Sets-Selection-Dominion2nd Edition"),o=localStorage.getItem("Sets-Selection-Intrigue1st Edition"),t=localStorage.getItem("Sets-Selection-Intrigue2nd Edition"),r="on"===localStorage.getItem("Generate-Drawer-ClusterPotions"),d="on"===localStorage.getItem("Generate-Drawer-DistributeSets"));const s={debug:DEBUG,sets:selectedSets,"Dominion1st Edition":e,"Dominion2nd Edition":a,"Intrigue1st Edition":o,"Intrigue2nd Edition":t,clusterPotions:r,distributeSets:d,appDir:absolutePath(window.location.href,"/"),randomness:10};$("#Generate-Button-Fab").addClass("hidden"),$(".cards-table-state").removeClass("state-open"),cardWorker.postMessage(s),cardWorker.onmessage=function(e){data=e.data,"success"===data.result?(cardWorker.terminate(),cardWorker=void 0,setLoadingProgress(17),window.setTimeout(()=>{setKingdomCards(data)},500)):"progress"===data.result?setLoadingProgress(data.progress):"error"===data.result&&(cardWorker.terminate(),cardWorker=void 0,showError(data.message))},cardWorker.onerror=function(e){void 0!==cardWorker&&(cardWorker.terminate(),cardWorker=void 0),showError("There was a problem generating the Kingdom"),console.error(`${e.message}\nAt line: ${e.lineno} in ${e.filename}`)}}}else showError("Sorry, Kingdom cannot run in your browser")}}function absolutePath(e,a){const o=e.split("/"),t=a.split("/");o.pop();for(let e=0;e<t.length;e++)"."!=t[e]&&(".."==t[e]?o.pop():o.push(t[e]));let r=o.join("/");for(;"/"===r.charAt(r.length-1);)r=r.slice(0,-1);return r}function setupSwitches(){const e=$("#Generate-Drawer-Sets");if(e.empty(),currentSetsCheckboxes=[],void 0!==typeof Storage)for(setName in totalSets){const a=`Sets-Selection-${setName}${setName}`;if("on"===localStorage.getItem(a)){const o=$("<div class='checkbox-check'></div>").appendTo(e);$(`<p>${setName}</p>`).appendTo(o);const t=$(`<input type='checkbox' id='Generate-Sets-${a}`+`' name='sets-${setName}' value='${setName}'/>`).appendTo(o);currentSetsCheckboxes.push(t);$(`<label for='Generate-Sets-${a}`+`' class='check-${setName.toLowerCase().replace(" ","")}'>`).appendTo(o);createCheckboxSwitch(o),t.change(function(){void 0!==typeof Storage?$(this).prop("checked")?localStorage.setItem($(this).attr("id"),"on"):localStorage.setItem($(this).attr("id"),"off"):console.log("Local storage not supported")});const r=localStorage.getItem(t.attr("id"));t.prop("checked","on"===r),t.trigger("change")}}return 0!==currentSetsCheckboxes.length}function selectAllSwitches(){for(setCheckbox of currentSetsCheckboxes)setCheckbox.prop("checked",!0),setCheckbox.trigger("change")}function deselectAllSwitches(){for(setCheckbox of currentSetsCheckboxes)setCheckbox.prop("checked",!1),setCheckbox.trigger("change")}function randomizeSwitches(){for(setCheckbox of currentSetsCheckboxes)setCheckbox.prop("checked",!1),setCheckbox.trigger("change");const e=parseInt($("#Generate-Drawer-RandomizeValue").text()),a=[];for(let e=0;e<currentSetsCheckboxes.length;++e)a.push(e);const o=[];for(;o.length<e&&a.length>0;){const e=Math.floor(Math.random()*a.length);o.push(a[e]),a.splice(e,1)}for(i of o)currentSetsCheckboxes[i].prop("checked",!0),currentSetsCheckboxes[i].trigger("change")}function setupGeneratorOptions(){if(void 0!==typeof Storage){const e=$("#Generate-Drawer-RandomizeInput"),a=$("#Generate-Drawer-RandomizeValue"),o=function(){const e=a.text();localStorage.setItem("Generate-Drawer-RandomizeValue",e)};e.on("input-value-change",o);const t=localStorage.getItem("Generate-Drawer-RandomizeValue");void 0!==t&&parseInt(t,10)>=1?(a.text(t),e.trigger("input-value-change")):(a.text("2"),e.trigger("input-value-change")),setupGeneratorCheckbox("Generate-Drawer-ClusterPotions"),setupGeneratorCheckbox("Generate-Drawer-DistributeSets")}}function setupGeneratorCheckbox(e,a=!0){const o=$(`#${e}`),t=localStorage.getItem(e);null!==t?o.prop("checked","on"===t):o.prop("checked",a),o.change(function(){$(this).prop("checked")?localStorage.setItem(e,"on"):localStorage.setItem(e,"off")})}function showError(e){clearCards(),hideLoadingIndicator(),isGenerating=!1,isGeneratingFromCode=!1,$("#Generate-Button-Fab").removeClass("hidden"),$(".cards-table-state").removeClass("state-open"),$(".toolbar-cards").addClass("hidden"),$(".toolbar-shuffle").addClass("hidden"),$(".error-msg").text(e),$(".error-msg").addClass("error-visible")}function clearKingdom(){animateCardsOut(),isGenerating=!1,isGeneratingFromCode=!1,$("#Generate-Button-Fab").removeClass("hidden"),$(".toolbar-cards").addClass("hidden"),$(".toolbar-shuffle").addClass("hidden"),window.setTimeout(()=>{$(".cards-table-state").addClass("state-open")},500)}function clearCards(){$("#CardsRow1").empty(),$("#CardsRow2").empty(),$("#CardsTablePortrait").empty(),$(".cards-table-basic").empty(),$(".cards-table-specialcards").empty(),currentKingdom={},loadedCards=0}function animateCardsOut(){$(".cards-table").removeClass("cards-animate-in"),$(".cards-table-basic").removeClass("cards-animate-in"),$(".cards-table-specialcards").removeClass("cards-animate-in"),$(".error-msg").removeClass("error-visible"),currentKingdom={},loadedCards=0,isGenerating||removeHash(),removeCardsTimeout=window.setTimeout(()=>{clearCards()},1e3)}function removeHash(){""!=window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search)}function setKingdomCards(e){const a=e.kingdomCards,o=e.supplyCards,t=e.baneCard,r=e.obeliskCard;clearCards(),clearTimeout(removeCardsTimeout),a.sort((e,a)=>{if("Event"===e.cardType||"Landmark"===e.cardType){if("Event"!==a.cardType&&"Landmark"!==a.cardType)return 1}else if(("Event"===a.cardType||"Landmark"===a.cardType)&&"Event"!==e.cardType&&"Landmark"!==e.cardType)return-1;return e.cost<a.cost?-1:e.cost>a.cost?1:"potion"===a.altCost&&"potion"!==e.altCost?-1:"potion"===e.altCost&&"potion"!==a.altCost?1:e.costDebt<a.costDebt?-1:e.costDebt>a.costDebt?1:e.cardName<a.cardName?-1:e.cardName>a.cardName?1:0});const d=[];let s=!1;for(kingdomCard of a)"potion"===kingdomCard.altCost&&(s=!0);for(extraSupplyCard of(s&&d.push("Potion"),o))d.push(extraSupplyCard);for(card of(currentKingdom={kingdomCards:a,extraSupplyCards:o,supplyCards:d,obeliskCard:r,baneCard:t}).kingdomCards)void 0===cardCounts[card.cardName]&&(cardCounts[card.cardName]=0),cardCounts[card.cardName]+=1;for(c in kingdomCardCount=[],cardCounts)kingdomCardCount.push({cardName:c,count:cardCounts[c]});for(c of(kingdomCardCount.sort((e,a)=>e.count-a.count<0?1:e.count-a.count>0?-1:e.cardName<a.cardName?-1:e.cardName>a.cardName?1:0),output="",kingdomCardCount))output+=`${c.cardName}: ${c.count}\n`;gamesPlayed+=1,"counts"!==DEBUG&&"all"!==DEBUG||(console.log(`Games Played: ${gamesPlayed}`),console.log(output));let n=0;const l={};let p=0,g=0;for(kingdomCard of currentKingdom.kingdomCards)if("Event"!==kingdomCard.cardType&&"Landmark"!==kingdomCard.cardType){if(void 0===l[kingdomCard.cost]){const e=`CardsRowCost${kingdomCard.cost}`;var m=$("<tr class='cards-table-row-outer'></tr>").appendTo($("#CardsTablePortrait"))[0];const a=$(`<div id='${e}' class='cards-table-row'></div>`);l[kingdomCard.cost]={row:a.appendTo(m)[0],cards:1},p+=1}else l[kingdomCard.cost].cards+=1,l[kingdomCard.cost].cards>g&&(g=l[kingdomCard.cost].cards);n+=1}for(m in l){const e=`${100*(l[m].cards/g)}%`;$(l[m].row).css("max-width",e),$(l[m].row).parent().css("height",`${100/p}%`)}const u=Math.floor(n/2);$(".cards-table").removeClass("cards-table-supply-special"),$(".cards-table-basic").removeClass("cards-table-supply-special");let C=0,h=0;for(i=0;i<currentKingdom.kingdomCards.length;++i){const e=currentKingdom.kingdomCards[i];if("Event"!==e.cardType&&"Landmark"!==e.cardType){const a=i<u?1:2;addCard(e,{isBane:e===t,isObelisk:e===r},a,1===a?i:i-4),1===a?C+=1:2===a&&(h+=1)}else $(".cards-table").addClass("cards-table-supply-special"),$(".cards-table-basic").addClass("cards-table-supply-special"),addSpecialCard(e)}C>h?($("#CardsRow1").css("max-width","100%"),$("#CardsRow2").css("max-width","83.3%")):h>C?($("#CardsRow1").css("max-width","83.3%"),$("#CardsRow2").css("max-width","100%")):($("#CardsRow1").css("max-width","100%"),$("#CardsRow2").css("max-width","100%")),$("#CardsRow1").parent().css("height","50%"),$("#CardsRow2").parent().css("height","50%");let v=!1;if(void 0!==currentKingdom.supplyCards&&currentKingdom.supplyCards.length>0&&(v=!0),v){$(".cards-table-basic");if($(".cards-table").addClass("cards-table-supply"),$(".cards-table-specialcards").addClass("cards-table-supply"),void 0!==currentKingdom.supplyCards)for(supplyCard of currentKingdom.supplyCards)addSupplyCard(supplyCard)}else $(".cards-table").removeClass("cards-table-supply"),$(".cards-table-specialcards").removeClass("cards-table-supply");updateUrlKingdomCode(),REPEAT&&gamesPlayed<REPEAT_MAX&&window.setTimeout(()=>{generateNewKingdom()},1e3)}function updateUrlKingdomCode(){if(currentKingdom.kingdomCards&&"undefined"!=typeof Worker){let e=new Worker("./app/scripts/card-selection/kingdom-code/kingdom-code.js");const a={request:"cards-to-code",kingdomCards:currentKingdom.kingdomCards,supplyCards:currentKingdom.extraSupplyCards,obeliskCard:currentKingdom.obeliskCard,baneCard:currentKingdom.baneCard,appDir:absolutePath(window.location.href,"/"),totalSets:totalSets};e.postMessage(a),e.onmessage=function(a){e.terminate(),e=void 0;const o=a.data;"success"===o.result?(currentKingdom.kingdomCode=o.kingdomCode,window.location.hash=o.kingdomCode):"error"===o.result&&console.error("Error")},e.onerror=function(a){e.terminate(),e=void 0,console.error(`${a.message}\nAt line: ${a.lineno} in ${a.filename}`)}}}function cardNameToFilename(e){let a=e.split(" ").join("_");return`${a=a.split("/").join("_")}.jpg`}function cardNameToUrl(e){let a=e.split(" ").join("_");return a=a.split("'").join("%27")}function addCard(e,a,o,t){const r=`#CardsRow${o}`,d=`#CardsRowCost${e.cost}`,s=$(r),n=$(d),i=`<div class='cards-table-card' ${`style='transition-delay: ${50*t}ms'`}></div>`,c=$(i).appendTo(s)[0],l=$("<div class='cards-table-card-inner'></div>").appendTo(c)[0],p=$(i).appendTo(n)[0],g=$("<div class='cards-table-card-inner'></div>").appendTo(p)[0];a.isBane&&($(c).addClass("card-bane"),$(p).addClass("card-bane")),a.isObelisk&&($(c).addClass("card-obelisk"),$(p).addClass("card-obelisk"));const m="./app/img/cards-small/"+e.cardSet.toLowerCase().replace(" ",""),u=(e.set,cardNameToFilename(e.cardName)),C=`<img src="${`${m}/${u}`}"/>`,h=$(C).appendTo(l)[0];$(C).appendTo(g)[0];$("<i class='material-icons'>zoom_in</i>").appendTo(c),$("<i class='material-icons'>zoom_in</i>").appendTo(p),$(h).one("load",()=>{incrementCardLoaded()}),$(h).complete&&$(h).load(),$(h).one("error",()=>{showError("There was a problem loading the cards")}),$(c).on("click",()=>{$(c).trigger("mouseup"),$(c).trigger("mouseleave"),createDialogForCard(m,e)}),$(p).on("click",()=>{$(p).trigger("mouseup"),$(p).trigger("mouseleave"),createDialogForCard(m,e)}),$(c).hover(()=>{$(c).addClass("hover")},()=>{$(c).removeClass("hover")}),$(p).hover(()=>{$(p).addClass("hover")},()=>{$(p).removeClass("hover")})}function addSupplyCard(e){const a=$(".cards-table-basic"),o=$("<div class='cards-table-card'></div>").appendTo(a),t=cardNameToFilename(e),r=$(`<img src='${"./app/img/supply/"+t}'/>`).appendTo(o);$("<i class='material-icons'>zoom_in</i>").appendTo(o),r.one("load",()=>{incrementCardLoaded()}),r.one("error",()=>{showError("There was a problem loading the cards")}),o.on("click",()=>{createDialogForCard("./app/img/supply/",{cardName:e})}),r.complete&&r.load(),$(o).hover(()=>{$(o).addClass("hover")},()=>{$(o).removeClass("hover")})}function addSpecialCard(e){const a=$(".cards-table-specialcards"),o=$("<div class='cards-table-card'></div>").appendTo(a);let t="./app/img/cards-small/";"Event"===e.cardType?t="./app/img/events/":"Landmark"===e.cardType&&(t="./app/img/landmarks/");const r=t+e.cardSet.toLowerCase().replace(" ",""),d=(e.set,cardNameToFilename(e.cardName)),s=$(`<img src='${`${r}/${d}`}'/>`).appendTo(o);$("<i class='material-icons'>zoom_in</i>").appendTo(o),s.one("load",()=>{incrementCardLoaded()}),s.complete&&s.load(),s.one("error",()=>{showError("There was a problem loading the cards")}),o.on("click",()=>{createDialogForCard(r,e)}),$(o).hover(()=>{$(o).addClass("hover")},()=>{$(o).removeClass("hover")})}function createDialogForCard(e,a){const o=a.cardName,t=$("<div class='dialog dialog-card-detail'></div>").appendTo($("body .main")),r=$("<div class='dialog-middle'></div>").appendTo(t),d=$("<div class='dialog-content'></div>").appendTo(r),s=$("<div class='dialog-content-inner'></div>").appendTo(d);"Event"!==a.cardType&&"Landmark"!==a.cardType||t.addClass("dialog-card-detail-landscape"),createDialog(t);const n=cardNameToFilename(o),i=`${e}/${n}`,c=$("<div class='card-image-container'></div>").appendTo(s);cardImage=$(`<img class='card-image-loading' src="${i}">`).appendTo(c),$("<i class='material-icons'>zoom_out</i>").appendTo(c),cardImage.one("load",()=>{cardImage.removeClass("card-image-loading")}),cardImage.complete&&cardImage.load();const l=$("<div class='card-toolbar'></div>").appendTo(s),p=$("<button class='btn-toolbar'>").appendTo(l);$("<i class='material-icons'>close</i>").appendTo(p),p.on("click",()=>{t.trigger("dialog-close")});const g=$("<div class='card-faq'></div>").appendTo(s);let m=WIKI_PREFIX+cardNameToUrl(o);const u=$("<div class='card-faq-loading'></div>").appendTo(g),C=$("<div class='loading-indeterminate-dots'></div>").appendTo(u);$("<span></span><span></span><span></span>").appendTo(C),$("<p class='loading-heading'>Loading</p>").appendTo(u);const h=$("<p class='loading-text'></p>").appendTo(u);h.text(o);const v=void 0!==a.splitCards&&a.splitCards.length>0,b="Split Pile"===a.cardType;if(b||v){if(b){var f=$("<button class='btn-toolbar'>").appendTo(l);$("<i class='material-icons'>account_balance</i>").appendTo(f),$("<div class='tooltip tooltip-right'>Kingdom Card</div>").appendTo(f),f.click(()=>{f.addClass("hidden"),k>=0&&(cardImage.addClass("split-fade-out"),window.setTimeout(()=>{k=-1,cardImage.attr("src",i),m=WIKI_PREFIX+cardNameToUrl(o),h.text(o),cardImage.one("load",()=>{window.setTimeout(()=>{cardImage.removeClass("split-fade-out")},125)}),cardImage.complete&&cardImage.load()},125))})}const t=$("<button class='btn-toolbar' style='margin-top: 5px'>").appendTo(l),r=[];let d=!1;if(b||r.push(o),v){for(splitCard of a.splitCards)r.push(splitCard);$("<div class='tooltip tooltip-right'>Next Card</div>").appendTo(t),$("<i class='material-icons'>navigate_next</i>").appendTo(t),d=!0}else{for(splitCard of o.split("/"))console.log(splitCard),r.push(splitCard);$("<div class='tooltip tooltip-right'>View Split Card</div>").appendTo(t),$("<i class='material-icons'>flip</i>").appendTo(t)}console.log(r);const s=cardNameToFilename(r[0]);let n=`${e}/split/${s}`;b||(n=`${e}/${s}`),cardImage.attr("src",n),m=WIKI_PREFIX+cardNameToUrl(r[0]),h.text(r[0]);var k=0;t.click(()=>{d?cardImage.addClass("multi-fade-out"):cardImage.addClass("split-fade-out"),b&&f.removeClass("hidden"),window.setTimeout(()=>{k=(k+1)%r.length;const a=cardNameToFilename(r[k]);let o=`${e}/split/${a}`;b||0!==k||(o=`${e}/${a}`),cardImage.attr("src",o),m=WIKI_PREFIX+cardNameToUrl(r[k]),h.text(r[k]),d&&cardImage.addClass("multi-fade-in"),cardImage.one("load",()=>{window.setTimeout(()=>{cardImage.removeClass("split-fade-out"),cardImage.removeClass("multi-fade-out"),cardImage.removeClass("multi-fade-in")},125)}),cardImage.complete&&cardImage.load()},125)})}$("<div type='cancel' class='btn-icon btn-dialog-minimize'><i class='material-icons'>close</i></div>").appendTo(s).click(()=>{t.trigger("dialog-close")}),c.on("click",()=>{t.trigger("dialog-close")})}function incrementCardLoaded(){++loadedCards>=currentKingdom.kingdomCards.length+currentKingdom.supplyCards.length&&(window.setTimeout(()=>{$(".cards-table").addClass("cards-animate-in"),$(".cards-table-basic").addClass("cards-animate-in"),$(".cards-table-specialcards").addClass("cards-animate-in"),hideLoadingIndicator(),$(".toolbar-cards").removeClass("hidden"),$(".toolbar-cards").prop("disabled",!1),isGeneratingFromCode?($(".toolbar-shuffle").addClass("hidden"),$(".toolbar-shuffle").prop("disabled",!0)):($(".toolbar-shuffle").removeClass("hidden"),$(".toolbar-shuffle").prop("disabled",!1)),isGeneratingFromCode=!1},200),isGenerating=!1)}function hideLoadingIndicator(){$("#LoadingIndicator").removeClass("loading"),window.setTimeout(()=>{$("#LoadingIndicator").removeClass("animating")},300)}function setLoadingProgress(e){e<0&&(e=0),(e>$("#LoadingIndicator").attr("data-progress")||0===e)&&$("#LoadingIndicator").attr("data-progress",e)}function openCodeDialog(){if(void 0===codeDialog){codeDialog=$("<div class='dialog dialog-code'></div>").appendTo($("body .main"));const e=$("<div class='dialog-middle'></div>").appendTo(codeDialog),a=$("<div class='dialog-content'></div>").appendTo(e),o=$("<div class='dialog-content-inner'></div>").appendTo(a);createDialog(codeDialog),$("<h1>Kingdom Code</h1>").appendTo(o),$("<div type='cancel' class='btn-icon btn-dialog-minimize'><i class='material-icons'>close</i></div>").appendTo(o).click(()=>{codeDialog.trigger("dialog-close")}),$("<p>Kingdom codes are a way to share sets of cards with other players in a game</p>").appendTo(o);const t=$("<div class='kingdom-code-container'></div>").appendTo(o);if(currentKingdom.kingdomCode){const e={text:currentKingdom.kingdomCode,background:"#fff",fill:"#111",render:"image",ecLevel:"H",minVersion:3,maxVersion:40,size:1200,radius:.1};t.qrcode(e)}const r=window.location.href;$(`<a href='${r}'>${r}</a>`).appendTo(o);const d=$("<div class='btn'>Copy Link to Clipboard</div>").appendTo(o),s=$("<div class='btn-message'>Copied Link!</div>").appendTo(d);d.on("click",()=>{copyToClipboard(window.location.href),s.addClass("visible"),window.setTimeout(()=>{s.removeClass("visible")},1e3)}),codeDialog.one("dialog-close",()=>{codeDialog=void 0})}}$(window).bind("hashchange",e=>{const a=window.location.hash.replace("#","");null!=a&&null!=a&&""!=a?a!=currentKingdom.kingdomCode&&loadKingdomFromCode(a):clearKingdom()}),$(()=>{const e=window.location.hash;if(null!=e&&""!==e&&loadKingdomFromCode(e.substring(1)),void 0!==typeof Storage){let a=0;for(setName in totalSets){const e=`Sets-Selection-${setName}${setName}`;"on"===localStorage.getItem(e)&&(a+=1)}0===a?($(".cards-table-state").addClass("state-sets"),$(".cards-table-state").removeClass("state-empty"),""===e&&openSetDialog(!0)):($(".cards-table-state").removeClass("state-sets"),$(".cards-table-state").addClass("state-empty"))}for(s of $(".checkbox-switch"))createCheckboxSwitch(s);setupGeneratorOptions(),$("#Generate-Button-Fab .btn-fab-btn").on("click",()=>{$("#Onboarding-Generate").removeClass("open"),setupSwitches()?$("#Generate-Drawer").trigger("drawer-open"):openSetDialog()}),$("#Generate-Drawer-Sets-SelectAll").on("click",()=>{selectAllSwitches()}),$("#Generate-Drawer-Sets-DeselectAll").on("click",()=>{deselectAllSwitches()}),$("#Generate-Drawer-Randomize").on("click",()=>{randomizeSwitches()}),$("#Generate-Button-New").on("click",()=>{generateNewKingdom()}),$("#Generate-Button-Shuffle").on("click",()=>{generateNewKingdom()}),$("#Generate-Button-Clear").on("click",()=>{clearKingdom()}),$("#Generate-Button-CodeScan").on("click",()=>{openScanDialog()}),$("#Generate-Button-Code").on("click",()=>{openCodeDialog()})}),codeDialog=void 0,codeScanDialog=void 0;const copyToClipboard=e=>{const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select(),iosCopyToClipboard(a),document.body.removeChild(a)};function iosCopyToClipboard(e){const a=e.contentEditable,o=e.readOnly,t=document.createRange();e.contentEditable=!0,e.readOnly=!0,t.selectNodeContents(e);const r=window.getSelection();r.removeAllRanges(),r.addRange(t),e.setSelectionRange(0,999999),e.contentEditable=a,e.readOnly=o,document.execCommand("copy")}function openScanDialog(){if(void 0===codeScanDialog){codeScanDialog=$("<div class='dialog dialog-code-scan'></div>").appendTo($("body .main"));const e=$("<div class='dialog-middle'></div>").appendTo(codeScanDialog)[0],a=$("<div class='dialog-content'></div>").appendTo(e)[0],o=$("<div class='dialog-content-inner'></div>").appendTo(a)[0];createDialog(codeScanDialog),$("<h1>Scan Code</h1>").appendTo(o),$("<div type='cancel' class='btn-icon btn-dialog-minimize'><i class='material-icons'>close</i></div>").appendTo(o).on("click",()=>{codeScanDialog.trigger("dialog-close")}),$("<p>Kingdom codes are generated with each kingdom, scan one here to view the cards. All data from the camera is processed on the device, and does not get sent anywhere.</p>").appendTo(o);let t=void 0,r=void 0;const d=$("<video autoplay playsinline></video>").appendTo(o)[0],s=$("<canvas id='qr-canvas'></canvas>").appendTo(o)[0];if(void 0!==navigator.mediaDevices){let e=!1;navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:!1}).then(e=>{r=e,d.srcObject=e,d.play()}).catch(e=>{console.log("Could not access camera")}),d.addEventListener("canplay",a=>{e||(d.removeAttribute("width"),d.removeAttribute("height"),s.setAttribute("width",d.videoWidth),s.setAttribute("height",d.videoHeight),$(d).addClass("visible"),e=!0,t=window.setInterval(()=>{s.getContext("2d").drawImage(d,0,0,s.width,s.height);try{qrcode.decode(),clearInterval(t)}catch(e){}},500))},!1)}qrcode.callback=function(e){console.log(e),loadKingdomFromCode(e)},$("<p>For best results the code should be in focus and centered. A short video of the code (1 or 2 seconds) will work better than a photo.</p>").appendTo(o);const n=$("<div class='photoinput-loading'></div>").appendTo(o)[0];$("<p class='photoinput-loading-text'>Scanning Photo</p>").appendTo(n),$("<p class='photoinput-loading-error'>Could not find code</p>").appendTo(n);const i=$("<input type='file' id='CodePhotoInput' accept='video/*;capture=camcorder' capture='camera'>").appendTo(o)[0];$("<label class='btn' for='CodePhotoInput'>Take a Photo or Video</label>").appendTo(o)[0];i.addEventListener("change",e=>{$(n).addClass("loading"),$(n).removeClass("error"),window.setTimeout(()=>{const a=s.getContext("2d");a.clearRect(0,0,s.width,s.height);const o=new Image;o.onload=function(){s.setAttribute("width",o.width),s.setAttribute("height",o.height),a.drawImage(o,0,0,s.width,s.height);try{qrcode.decode()}catch(e){console.log("No code found"),$(n).removeClass("loading"),$(n).addClass("error")}};const t=e.target.files[0];o.src=URL.createObjectURL(t)},400)}),codeScanDialog.one("dialog-close",()=>{if(void 0!==r)for(track of r.getTracks())track.stop();void 0!==t&&clearInterval(t),codeScanDialog=void 0})}}function loadKingdomFromCode(e){if(!isGenerating&&!isGeneratingFromCode&&void 0===cardWorker&&(isGenerating=!0,isGeneratingFromCode=!0,currentKingdom.kingdomCards?animateCardsOut():$(".error-msg").removeClass("error-visible"),$("#Generate-Button-Fab").trigger("card-close"),$("#LoadingIndicator").addClass("loading"),$("#LoadingIndicator").addClass("animating"),setLoadingProgress(0),$(".toolbar-cards").prop("disabled",!0),$(".toolbar-shuffle").prop("disabled",!0),void 0!==codeDialog&&codeDialog.trigger("dialog-close"),void 0!==codeScanDialog&&codeScanDialog.trigger("dialog-close"),"undefined"!=typeof Worker&&void 0===cardWorker)){cardWorker=new Worker("./app/scripts/card-selection/kingdom-code/kingdom-code.js");const a={request:"code-to-cards",kingdomCode:e,totalSets:totalSets,appDir:absolutePath(window.location.href,"/")};cardWorker.postMessage(a),$("#Generate-Button-Fab").addClass("hidden"),$(".cards-table-state").removeClass("state-open"),cardWorker.onmessage=function(e){data=e.data,"success"===data.result?(cardWorker.terminate(),cardWorker=void 0,setLoadingProgress(17),window.setTimeout(()=>{setKingdomCards(data)},500)):"progress"===data.result?setLoadingProgress(data.progress):"error"===data.result&&(cardWorker.terminate(),cardWorker=void 0,showError(data.message),$("#Generate-Button-Fab").removeClass("hidden"))},cardWorker.onerror=function(e){void 0!==cardWorker&&(cardWorker.terminate(),cardWorker=void 0),showError("There was a problem loading the code"),console.error(`${e.message}\nAt line: ${e.lineno} in ${e.filename}`),$("#Generate-Button-Fab").removeClass("hidden")}}}